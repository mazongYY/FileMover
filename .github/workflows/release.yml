name: Create Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v1.0.0)'
        required: true
        default: 'v1.0.0'

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        pip install rarfile py7zr
        
    - name: Build executable
      run: |
        pyinstaller --onefile --windowed --name=FileMover --clean main.py
        
    - name: Create release package
      run: |
        mkdir release
        copy dist\FileMover.exe release\
        copy dist\ä½¿ç”¨è¯´æ˜.txt release\ 2>nul || echo "ä½¿ç”¨è¯´æ˜.txt not found, skipping"
        
    - name: Archive release
      uses: actions/upload-artifact@v3
      with:
        name: FileMover-Release
        path: release/
        
  release:
    needs: build
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Download artifacts
      uses: actions/download-artifact@v3
      with:
        name: FileMover-Release
        path: release/
        
    - name: Get version
      id: get_version
      run: |
        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
          echo "version=${{ github.event.inputs.version }}" >> $GITHUB_OUTPUT
        else
          echo "version=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
        fi
        
    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ steps.get_version.outputs.version }}
        release_name: FileMover ${{ steps.get_version.outputs.version }}
        body: |
          ğŸš€ **FileMover ${{ steps.get_version.outputs.version }} - ç°ä»£åŒ–æ–‡ä»¶ç­›é€‰å·¥å…·**

          ## âœ¨ æ–°åŠŸèƒ½
          - ğŸ¨ **å…¨æ–°ç°ä»£åŒ–UIè®¾è®¡** - æ·±è‰²ä¸»é¢˜ï¼Œåœ†è§’æŒ‰é’®ï¼Œå¡ç‰‡å¼å¸ƒå±€
          - ğŸš€ **è‡ªåŠ¨æ‰“å¼€æ–‡ä»¶å¤¹** - å¤„ç†å®Œæˆåç›´æ¥æ‰“å¼€è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œæ— å¼¹çª—å¹²æ‰°
          - ğŸ“¦ **ç®€åŒ–é¡¹ç›®ç»“æ„** - é‡æ„ä¸ºå•ä¸€main.pyæ–‡ä»¶ï¼Œæ˜“äºç»´æŠ¤
          - ğŸŒ **ä¸­æ–‡ä¼˜å…ˆæ–‡æ¡£** - åŒè¯­READMEï¼Œé»˜è®¤æ˜¾ç¤ºä¸­æ–‡å†…å®¹

          ## ğŸ”§ ä¼˜åŒ–æ”¹è¿›
          - ğŸ›¡ï¸ **å½»åº•è§£å†³è¿è¡Œæ—¶é”™è¯¯** - ç§»é™¤å¤æ‚ä¾èµ–ï¼Œæé«˜ç¨³å®šæ€§
          - ğŸ“ **ç»Ÿä¸€æ–‡ä»¶ç»“æ„** - åˆ é™¤å¤šä½™æ–‡ä»¶ï¼Œä¿æŒé¡¹ç›®ç®€æ´
          - ğŸ¯ **ç”¨æˆ·ä½“éªŒä¼˜åŒ–** - ç®€åŒ–æ“ä½œæµç¨‹ï¼Œæå‡ä½¿ç”¨æ•ˆç‡
          - ğŸ“‹ **æ ‡å‡†åŒ–æ–‡æ¡£** - ç¬¦åˆGitHubå¼€æºé¡¹ç›®æ ‡å‡†

          ## ğŸ› ä¿®å¤é—®é¢˜
          - âœ… **æ–‡ä»¶é€‰æ‹©é—®é¢˜** - ä¿®å¤æµè§ˆæ–‡ä»¶åè·¯å¾„ä¸æ˜¾ç¤ºçš„é—®é¢˜
          - âœ… **å ä½ç¬¦å¤„ç†** - ä¼˜åŒ–è¾“å…¥æ¡†å ä½ç¬¦é€»è¾‘
          - âœ… **UIæ ‡é¢˜ä¼˜åŒ–** - å»é™¤å†—ä½™ç‰ˆæœ¬ä¿¡æ¯ï¼Œç•Œé¢æ›´ç®€æ´

          ## ğŸ“¦ ä¸‹è½½è¯´æ˜
          - **FileMover.exe** - Windowså¯æ‰§è¡Œæ–‡ä»¶ï¼ˆçº¦8MBï¼‰
          - **ä½¿ç”¨è¯´æ˜.txt** - è¯¦ç»†ä½¿ç”¨æŒ‡å—

          ## ğŸ’» ç³»ç»Ÿè¦æ±‚
          - Windows 7/8/10/11
          - æ— éœ€å®‰è£…Pythonæˆ–å…¶ä»–ä¾èµ–

          ## ğŸš€ å¿«é€Ÿå¼€å§‹
          1. ä¸‹è½½FileMover.exe
          2. åŒå‡»è¿è¡Œç¨‹åº
          3. é€‰æ‹©å‹ç¼©åŒ…æ–‡ä»¶
          4. è¾“å…¥å…³é”®å­—
          5. é€‰æ‹©æ“ä½œæ¨¡å¼
          6. å¼€å§‹å¤„ç†

          ---

          **â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼**
        draft: false
        prerelease: false
        
    - name: Upload Release Asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: release/FileMover.exe
        asset_name: FileMover.exe
        asset_content_type: application/octet-stream
